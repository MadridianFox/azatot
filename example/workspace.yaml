name: ensi
variables:
  NETWORK: ensi
  BASE_DOMAIN: ensi.127.0.0.1.nip.io

templates:
  - name: php80
    path: ${WORKSPACE_PATH}/templates/php8
    compose_file: ${TPL_PATH}/docker-compose.yml
    variables:
      BASE_IMAGE: php:8.0-fpm-alpine
      APP_IMAGE: php80:latest
      NGINX_IMAGE: nginx:1.19-alpine
  - name: php81
    path: ${WORKSPACE_PATH}/templates/php8
    compose_file: ${TPL_PATH}/docker-compose.yml
    variables:
      BASE_IMAGE: php:8.1-fpm-alpine
      APP_IMAGE: php81:latest
      NGINX_IMAGE: nginx:1.19-alpine

services: 
  - name: api
    extends: php80
    path: ${WORKSPACE_PATH}/apps/api
    variables:
      VAR1: ${VAR1:-default}
      VAR2: ${BAZINGA}
      ERROR: ${UNDEFINED}
    dependencies:
      proxy: [dev, test]
      cms: [dev]
  - name: cms
    extends: php81
    path: ${WORKSPACE_PATH}/apps/cms
    dependencies:
      proxy: [dev, test]
      api: [dev]
  - name: proxy
    path: ${WORKSPACE_PATH}/apps/proxy
    compose_file: ${SVC_PATH}/docker-compose.yml
    variables:
      APP_IMAGE: jwilder/nginx-proxy:latest

modules:
  - name: cms-client
    path: ${WORKSPACE_PATH}/packages/cms-client
    hosted_in: api
    exec_path: ${WORKSPACE_PATH}/packages/cms-client # module mounted to container with same path as at host