name: ensi
variables:
  NETWORK: ensi
  BASE_DOMAIN: ensi.127.0.0.1.nip.io

templates:
  - name: php80
    path: {{.WorkspacePath}}/templates/php8
    compose_file: {{.WorkspacePath}}/templates/php8/docker-compose.yml
    variables:
      BASE_IMAGE: php:8.0-fpm-alpine
      APP_IMAGE: php80:latest
      NGINX_IMAGE: nginx:1.19-alpine
  - name: php81
    path: {{.WorkspacePath}}/templates/php8
    compose_file: {{.WorkspacePath}}/templates/php8/docker-compose.yml
    variables:
      BASE_IMAGE: php:8.1-fpm-alpine
      APP_IMAGE: php81:latest
      NGINX_IMAGE: nginx:1.19-alpine

services: 
  - name: api
    extends: php80
    path: {{.WorkspacePath}}/apps/api
    dependencies:
      - cms
  - name: cms
    extends: php81
    path: {{.WorkspacePath}}/apps/cms
    dependencies:
      - proxy
  - name: proxy
    path: {{.WorkspacePath}}/apps/proxy
    compose_file: {{.WorkspacePath}}/apps/proxy/docker-compose.yml
    variables:
      APP_IMAGE: jwilder/nginx-proxy:latest